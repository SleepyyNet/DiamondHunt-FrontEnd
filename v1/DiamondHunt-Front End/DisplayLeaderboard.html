<!DOCTYPE html>
<html>
	<head>
		<title> Leaderboard </title>
		
		<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.1.1/css/bootstrap.min.css">
		
		<script language src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
		
		<script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.0-rc2/js/bootstrap.js"></script>
		
		<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore.js"></script>
		
		<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone.js"></script>
		
		
	</head>
	
	<body>
		<div class = "container">
			
			<hr />
			<div class = "page"> </div>
		</div>
		
		<script type = "text/template" id = "user-list-template">
		
		<h1> DiamondHunt Leaderboard</h1>
		
			<table class = "table striped">
				<thead>
					<tr>
						<th>id</th>
						<th>username</th>
						<th>points</th>
						<th>kills</th>
						<th>killspree</th>
						<th>xp</th>
						<th>mines</th>
						<th>currency</th>
						<th>diamonds</th>
						<th>level</th>
						<th>missionscomplete</th>
						<th>friends</th>
					</tr>
				</thead>
				
				<tbody>
					<% _.each(userStats, function(user){ %>
						<tr>
							<td><%= user.get('id') %></td>
							<td><%= user.get('username') %></td>
							<td><%= user.get('points') %></td>
							<td><%= user.get('kills') %></td>
							<td><%= user.get('killspree') %></td>
							<td><%= user.get('xp') %></td>
							<td><%= user.get('mines') %></td>
							<td><%= user.get('currency') %></td>
							<td><%= user.get('diamonds') %></td>
							<td><%= user.get('level') %></td>
							<td><%= user.get('missionscomplete') %></td>
							<td><%= user.get('friends') %></td>
						</tr>
					<%	}); %>
				</tbody>
			</table>
		</script>
		
		<script>
			$.ajaxPrefilter( function(options, originalOptions, jqXHR){
				options.url = 'http://localhost:8888/l4/public/api/v1' + options.url;
			});
			
			var UserStats = Backbone.Collection.extend({
				url: '/getLeaderboard'
			});

			var DisplayUserStats = Backbone.View.extend({
				el: '.page',
				render: function(){
					var that = this;
					var userStats = new UserStats();
					userStats.fetch({
						success: function(userStats){
							var template = _.template($('#user-list-template').html(), {userStats: userStats.models});
							that.$el.html(template);
						}
					});
				}
			});

			var displayUserStats = new DisplayUserStats();

			var Router = Backbone.Router.extend({
				routes:{
					'': 'displayUserStats'
				}
			});

			var router = new Router();

			router.on('route:displayUserStats', function(){
				displayUserStats.render();
			});
			Backbone.history.start();
		</script>
	</body>
	
</html>