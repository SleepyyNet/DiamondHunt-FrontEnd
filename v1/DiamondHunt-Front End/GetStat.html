<!DOCTYPE html>
<html>
	<head>
		<title> Leaderboard </title>
		
		<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.1.1/css/bootstrap.min.css">
		
		<script language src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
		
		<script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.0-rc2/js/bootstrap.js"></script>
		
		<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore.js"></script>
		
		<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone.js"></script>
		
		
	</head>
	
	<body>
		<div class = "container">
			
			<hr />
			<div class = "page"> </div>
		</div>
		
		<script type = "text/template" id = "stat-list-template">
			<h1> Leaderboard: Points </h1>

			<table class = "table striped">
				<thead>
					<tr>
						<th>Username</th>
						<th>Stat Name</th>
					</tr>
				</thead>
				
				<tbody>
				<% _.each(statDataCollection, function(stat){ %>
					<tr>
						<td> <%= stat.get('username') %></td>
						<td> <%= stat.get('points') %> </td>
					</tr>
				<%	}); %>
				</tbody>
			</table>
		</script>
		
		<script>
			$.ajaxPrefilter( function(options, originalOptions, jqXHR){
				options.url = 'http://localhost:8888/l4/public/api/v1' + options.url;
			});
			
			var StatDataCollection = Backbone.Collection.extend({
				url: '/getLeaderboard/points'
			});
			
			var DisplayLeaderboardStat = Backbone.View.extend({
				el: '.page',
				render: function(){
					var that = this;
					var statDataCollection = new StatDataCollection();
					statDataCollection.fetch({
						success: function(statDataCollection){
							var template = _.template($('#stat-list-template').html(), {statDataCollection: statDataCollection.models});
							that.$el.html(template);
						}
					});
				}
			});
			
			var displayLeaderboardStat = new DisplayLeaderboardStat();
			
			var Router = Backbone.Router.extend({
				routes:{
					'': 'displayLeaderboard'
				}
			});
			
			var router = new Router();
			router.on('route:displayLeaderboard', function(){
				displayLeaderboardStat.render();
			});
			
			Backbone.history.start();
			
		</script>
		
	</body>
	
</html>